## Set Up
use `npm install` to install all dependencies.

The *webdriver-manager* is a helper tool to easily get an instance of a Selenium Server running. Use it to download the necessary binaries with:
`npm run webdriver-update`

## Test
Run the tests with
`npm run test` which will automatically call *npm run tsc* before testing.

You can run tests specifically with
`protractor conf.js --suite [which you want to run]`

Before running, you might want to compile the typescript files into js files through
`npm run tsc`

Protractor has default feature where you are allowed to pass some parameters from command line. For e.g.
`protractor conf.js --baseUrl <UrlToTest> --suite <SuiteName>`
can overwrite the *baseUrl* set in *conf.js*.
You can store different urls in *conf.js - onPrepare* by adding cases in switch, and then pass *--**params**.baseUrl* to command. For e.g
`protractor conf.js --params.baseUrl firsturl --suite smoke`
will overwrite the params.baseUrl with the firsturl set in *conf.js*.

*browser.baseUrl* represents the url for the nginx server, and *browser.params.baseUrl* represents the url for real htmlaccess server.

To check the screenshot report, open *./REPORTS/screenshot/index.html* in browser.

If there are npm or package errors, try delete *node_modules* and *package-lock.json* and reinstall the packages through `npm install`.
## Test Cases
Test cases can be found at [HTML5 client automation](https://confluence.eng.vmware.com/display/CNVDES/HTML5+client+automation)
## Debug
### Capture Console.log
```javascript
browser.manage().logs().get('browser').then(function(browserLog) {
    // browserLogs is an array of objects with level and message fields
    browserLog.forEach(function(log){
        if (log.level.value > 900) { // it's an error log
        console.log('Browser console error!');
        console.log(log.message);
        }
    })
})
```
To capture different levels of logs, change the capabilities of browser in *conf.js*: capabilities: { loggingPrefs: {'browser': 'INFO'} } to *INFO*, *DEBUG*, *WARNING*, *SEVERE* or simply *ALL*.
### Protractor Debugger
see [Debugging Protractor Tests](https://github.com/angular/protractor/blob/master/docs/debugging.md)
<!-- -   Add “debugger” keyword to the test case that we want to debug.

    ```javascript
    it('should greet the named user', async function() {
        debugger;
        await browser.get('http://www.angularjs.org');

        await element(by.model('yourName')).sendKeys('Julie');

        var greeting = element(by.binding('yourName'));

        expect(await greeting.getText()).toEqual('Hello Julie!');
    });
    ```

-   Start test process with a new argument "inspect-brk", which will enable
    inspector agent, listen on default address and port (127.0.0.1:9229) and
    break before user code starts

    Use

    ```
    npm run debug
    ```

-   Open chrome inspector: Enter "chrome://inspect/#devices" in browser, find
    the current running target and click “Inspect”

    ![screenshot](/docs/inspector.png)

-   The test will start and pause at the beginning.

    ![screenshot](/docs/firstBreak.png)

-   We can click F8 (resume script execution), and the test will pause at the
    first line that has our “debugger” keyword. We can then add breakpoints and
    debug tests.

    ![screenshot](/docs/breakpoint.png)

-   We can also open chrome development tool on the webdriver controlled browser
    to check the html elements and do some queries while the test execution is
    pausing.

    ![screenshot](/docs/chromeDevTool.png)

 -->
### mochawesome protractor screenshot plugin
The autogenerated screenshots can be found in *./REPORTS/screenshot/index.html*. The file path and other infos can be configured in *conf.js - mochaOpts*.
If you need to log data to report or custom screenshots to report, see [mochawesome-screenshots](https://github.com/BelAn97/mochawesome-screenshots) for details.

### Eslint
run `npm run lint` to lint the typescript files.

## Resources
* [MockXML](https://gitlab.eng.vmware.com/horizonweb/mockxml)
* [Protractor Tutorial](https://www.protractortest.org/#/tutorial)
* [Protractor Style Guide](https://www.protractortest.org/#/style-guide)
* [Build your first tests with Protractor](https://blog.cloudboost.io/building-your-first-tests-for-angular5-with-protractor-a48dfc225a75)
* [ExpectedConditions](http://www.protractortest.org/#/api?view=ProtractorExpectedConditions)
* [chai-as-promised](https://www.chaijs.com/plugins/chai-as-promised/)
* [Using ESLint and Prettier in a TypeScript Project](https://dev.to/robertcoopercode/using-eslint-and-prettier-in-a-typescript-project-53jb)